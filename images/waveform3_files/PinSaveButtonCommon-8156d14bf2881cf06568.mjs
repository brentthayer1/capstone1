(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([["PinSaveButtonCommon"],{"2qKt":function(e,t,n){var i=n("q1tI"),s=n("/MKj"),a=(n("17x9"),n("/5zs")),o=n("Vzit"),r=n("vh5K"),c=n("pLLR"),l=n("fArA");function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const h={shouldUsePlacedExperience:!0,dispatchMountActionDuringSSR:!1};t.a=(e,t={},n)=>d=>{const p=function(e){return t=>{return{experience:t.experiences.eligibleExperiences[e]}}}(e);n=Object.assign({},h,n);const m=function(e,t,n=!0,s=!0,c){return class extends i.Component{constructor(e){super(e),u(this,"state",{extraContext:void 0}),u(this,"setExtraContextState",e=>this.setState({extraContext:e}))}componentDidMount(){this.dispatchPlacementMount(!1)}UNSAFE_componentWillUpdate(n,i){const{dispatch:s,experience:c,requestContext:l}=n,u=new a.c(l,"web_bypass_eligible_experience").enabledWithNoActivation();let h=t;if(u&&"function"==typeof t){const a=t(this.props,this.state);h=t(n,i.extraContext||{}),JSON.stringify(a)!==JSON.stringify(h)&&s(Object(o.c)(e,h,u))}else{if("function"==typeof t){const e=i.extraContext||{};h=t(n,e)}if(!Object(r.d)(c)&&"function"==typeof t&&h&&Object.keys(h).length){const n=t(this.props,this.state);JSON.stringify(n)!==JSON.stringify(h)&&s(Object(o.c)(e,h))}}!c||this.props.experience&&c.id===this.props.experience.id||s(Object(o.i)(e,h))}componentWillUnmount(){const{dispatch:t}=this.props;t(Object(o.k)(e))}dispatchPlacementMount(n){const{dispatch:i,requestContext:s}=this.props;let r={};r="function"==typeof t?t(this.props,this.state):Object.assign({},t);const c=!n&&new a.c(s,"web_bypass_eligible_experience").enabled();i(Object(o.j)(e,r,n,c))}render(){const{experience:e}=this.props;return i.createElement(c,Object.assign({},this.props,{setPlacementExtraContext:this.setExtraContextState,experience:Object(r.d)(e)?e:null}))}}}(e,t,n.shouldUsePlacedExperience,n.dispatchMountActionDuringSSR,d);return Object(l.compose)(c.e,Object(s.connect)(p))(m)}},PNKV:function(e,t,n){},WnNx:function(e,t,n){function i(e){return{type:"SHOW_REPIN_ANIMATION",payload:{pinId:e}}}function s(){return{type:"HIDE_REPIN_ANIMATION"}}function a(){return{type:"SHOW_USECASE_FLYOUT"}}function o(){return{type:"HIDE_USECASE_FLYOUT"}}n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return s})),n.d(t,"d",(function(){return a})),n.d(t,"b",(function(){return o}))},dMCU:function(e,t,n){n.d(t,"a",(function(){return c}));var i=n("q1tI"),s=n.n(i),a=n("/MKj"),o=n("v/Q4"),r=n("+PUW");function c(e){const t=t=>{const n=Object(a.useDispatch)(),{isAuth:i,isLimitedLogin:c}=Object(o.a)(),l=!i||c?e=>e=>{e&&e.stopPropagation(),n(r.b)}:e=>e;return s.a.createElement(e,Object.assign({authAction:l,dispatch:n,isAuth:i,isLimitedLogin:c},t))};return t.displayName=`WithAuthenticatedAction(${String(e.displayName||e.name)})`,t}},jZhD:function(e,t,n){n.d(t,"a",(function(){return o}));var i=n("q1tI"),s=(n("17x9"),n("pdBG"));function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class o extends i.Component{constructor(...e){super(...e),a(this,"searchCache",Object.create(null)),a(this,"lastSearchedQuery",null),a(this,"search",e=>{this.lastSearchedQuery=e,e in this.searchCache?this.props.onTypeaheadSuggestionsChange(this.searchCache[e],e):this.provider.search(e,({items:t})=>{this.searchCache[e]=t,e===this.lastSearchedQuery&&this.props.onTypeaheadSuggestionsChange(t,e)})})}componentDidMount(){const e=this.props.resourceOptions||{};this.provider=new s.a({resource_name:this.props.resourceName,...e});const{value:t}=this.props;null!=t&&this.props.allowSearchOnMount&&this.search(this.props.value)}UNSAFE_componentWillReceiveProps({value:e}){null!=e&&e!==this.props.value&&this.search(e)}render(){return this.props.children||null}}a(o,"defaultProps",{resourceName:"TypeaheadResource"})},oTtT:function(e,t,n){n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return c}));var i=n("FZ8N"),s=n("j0Fm");const{Provider:a,useHook:o}=Object(s.a)({name:"board_picker",v2LoggerMetricName:16,sampleRate:i.b?1:.1}),r=a,c=o},pdBG:function(e,t,n){var i=n("AHhP"),s=n.n(i);const a=function(e,t){this.uid=e,this.item=t,this.next=null,this.prev=null},o=function(e){this._maxNumItems=e||10,this._uidToData={},this._numItems=0,this._firstData=null,this._lastData=null};o.prototype.set=function(e,t){let n=this._uidToData[e];n||(n=new a(e,t),this._uidToData[e]=n,this._numItems+=1),this._moveToFront(n),this._numItems>this._maxNumItems&&this._evict()},o.prototype.get=function(e){const t=this._uidToData[e];return t?(this._moveToFront(t),t.item):null},o.prototype.remove=function(e){const t=this._uidToData[e];t&&(delete this._uidToData[e],this._firstData===t&&(this._firstData=t.next),this._lastData===t&&(this._lastData=t.prev),t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),this._numItems-=1)},o.prototype._moveToFront=function(e){this._firstData!==e&&(this._firstData?(this._lastData===e&&(this._lastData=e.prev),e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),this._firstData.prev=e,e.next=this._firstData,e.prev=null,this._firstData=e):(this._firstData=e,this._lastData=e))},o.prototype._evict=function(){delete this._uidToData[this._lastData.uid],this._firstData===this._lastData?(this._firstData=null,this._lastData=null):(this._lastData=this._lastData.prev,this._lastData.next=null),this._numItems-=1};var r=o,c=n("eOdZ"),l=n("mBfy");const u=function(e){e=e||{},this.tags=e.tags,this.enable_recent_queries=!!e.enable_recent_queries,this.minimum_term_character_length=e.minimum_term_character_length||0,this.bypass_lru_cache=e.bypass_lru_cache;const t={tags:e.tags,pin:e.pin_id},n=e.num_places;n?t.num_places=n:t.count="count"in e?e.count:5,e.exclude_non_followers&&(t.exclude_non_followers=!0),e.field_set_key&&(t.field_set_key=e.field_set_key),e.pin_scope&&(t.pin_scope=e.pin_scope),e.suggestion_type&&(t.suggestion_type=e.suggestion_type);let i="TypeaheadResource";e.resource_name&&(i=e.resource_name),this.searchResource=c.a.create(i,t),this.itemsCache=new r};Object.assign(u.prototype,s.a),Object.assign(u.prototype,{search(e,t){let n;if(!e&&"pinners_and_contacts"===this.tags)return this.abortSearch(),this.publishData(e,[],{},t);if(!e&&l.default.isLimitedLogin())return this.abortSearch(),this.publishData(e,[],{},t);if(!e&&this.enable_recent_queries&&l.default&&l.default.isAuthenticated())n="recent_search";else{const n=this.bypass_lru_cache?{}:this.itemsCache.get(e);if(n){const i=n.items;if(i&&i.length){this.abortSearch();const s=n.hint;return void this.publishData(e,i,s,t)}}}e.length>=this.minimum_term_character_length?this.fetch(e,n,t):this.publishData(e,[],{},t)},getResource(){return this.searchResource},abortSearch(){this.getResource().abort()},publishData(e,t,n,i){const s={term:e,items:t,hint:n};this.trigger("data",s),i&&i(s)},setAutocompleteScope(e){this.getResource().set("autocompleteScope",e)},fetch(e,t,n){const i=this.getResource();if(i.isCalling()){const t=i.get("term");if(e===t)return;this.abortSearch()}""!==this.tags&&(i.set("term",e),i.set("tags",t||this.tags),i.resetBookmark(),i.callGet({showError:!1}).then(t=>{const i=t.resource_response.data,s=i.items,a=i.hint||{},o={hint:a,items:s};this.cacheData(e,o),this.publishData(e,s,a,n)},e=>{this.trigger("fetchError",e)}),this.warm=!0)},removeCacheForTerm(e){this.itemsCache.remove(e)},cacheData(e,t){this.itemsCache.set(e,t)},prefetch(){if(this.warm)return;c.a.create("TypeaheadPrepareResource").callGet({showError:!1}),this.warm=!0}});t.a=u},rO08:function(e,t,n){n.r(t),n.d(t,"PinSaveButton",(function(){return x}));var i=n("q1tI"),s=n.n(i),a=n("/MKj"),o=n("Ye/N"),r=n("TiQD"),c=n("rYoy"),l=n("y9Ij"),u=n("dMCU"),h=n("n02X"),d=n("2qKt"),p=n("n6mq"),m=n("0nTG"),b=n("lm6u"),_=n("C0mq"),f=n("B6Tf"),v=n("oTtT"),g=n("pLLR"),S=n("fArA");function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const C=Object(i.lazy)(()=>n.e("FirstPinCreateCommon").then(n.bind(null,"kj35"))),O=[500639,11022];class x extends i.Component{constructor(e){super(e),y(this,"componentWillUnmount",()=>{this._repinCompletionPromise&&this._repinCompletionPromise.cancel()}),y(this,"setCompletionPromise",e=>{this._repinCompletionPromise=e,this._repinCompletionPromise.promise.then(()=>{this.handleRepinHideAndToggle()})}),y(this,"_repinCompletionPromise",null),y(this,"handleRepinHide",()=>{this.setState({isRepinModalOpen:!1})}),y(this,"handleRepinHideAndToggle",()=>{this.setState({isRepinModalOpen:!1});const{onToggleModal:e}=this.props;e&&e(!1)}),y(this,"handleSaveButtonClick",this.props.authAction(e=>{e&&(e.preventDefault(),e.stopPropagation());const{onClickCallback:t,onToggleModal:n,oneTapSave:i,boardPickerStopwatch:s}=this.props;t&&t(),i?i.saved||"function"!=typeof i.save||i.save():(s&&s.start(),n&&n(!0),this.setState({isRepinModalOpen:this.props.isAuth}))})),y(this,"handleSavedButtonClick",()=>{const{history:e,pin:t,pinSavedInfo:n,viewerId:i}=this.props;let s;t.pinner.id===i?s=t.board.url:n&&(s=n.url),s&&e.push(s)}),y(this,"saveButtonRef",Object(i.createRef)()),y(this,"renderPinToBoardRepin",()=>{const{isCloseupPin:e,onToggleModal:t,pin:n}=this.props,{isFPE:i,isRepinModalOpen:a}=this.state;return a&&i?this.renderFPE():i?null:s.a.createElement(b.a,{action:"repin",additionalCreateFields:{is_stl_pin:Object(m.g)(n)},onClose:this.handleRepinHide,setCompletionPromise:this.setCompletionPromise,shouldShowToast:!0,onToggleModal:t,pin:n},({dismissModal:i,displaySuccessAnimation:o,handleAbort:r,handleNewBoardAnimationCompletion:c,handleSocialConnectSet:l,handleSaveToBoard:u,newPin:h,updateDescription:d,modalTitle:p,setModalTitle:m})=>s.a.createElement(f.b,{dismissModal:i,displaySuccessAnimation:o,handleSocialConnectSet:l,handleSaveToBoard:u,anchorRef:this.saveButtonRef.current,handleAbort:r,handleNewBoardAnimationCompletion:c,newPin:h,isCloseupPin:e,isInModal:!0,onToggleModal:t,pin:n,pwtAuxData:{pin_create_method:"repin"},modalTitle:p,setModalTitle:m,shouldRenderContent:a,updateDescription:d}))});const{experience:t,showRepinOnInitialRender:n}=e;this.state={isFPE:!!t&&O.includes(t.experience_id),isRepinModalOpen:n||!1}}componentDidMount(){const{onMount:e}=this.props;e&&e()}shouldComponentUpdate(e,t){return!this.isFPERemoved(e)}isFPERemoved(e){const{isFPE:t}=this.state,{experience:n}=e;return t&&(!n||!O.includes(n.experience_id))}renderFPE(){const{completePinSave:e,experience:t,pin:n}=this.props;return s.a.createElement(r.b,{accessibilityModalLabel:o.a._("Create board","Accessible create board education modal label","Accessible create board education modal label"),heading:o.a._("Create board","Create board education modal label","Create board education modal label"),onDismiss:this.handleRepinHideAndToggle,size:"lg"},s.a.createElement(p.d,{dangerouslySetInlineStyle:{__style:{marginBottom:64}}},s.a.createElement(c.a,null,s.a.createElement(s.a.StrictMode,null,s.a.createElement(C,{anchorRef:this.saveButtonRef.current,experience:t,isInModal:!0,onClose:this.handleRepinHideAndToggle,onComplete:e,pin:n,pwtAuxData:{pin_create_method:"repin"}})))))}render(){const{anchorString:e,icon:t,iconOnly:n,isCloseupPin:a,oneTapSave:o,pin:r,renderPinSaveTooltip:c,requestContext:u,variant:d,viewerId:m}=this.props,b=Object(h.a)(e||"")(l.a),_=!!(r.pinner.id===m||r.saved||r.savedInfo||"controlled"===(null==o?void 0:o.type)&&o.saved),f="controlled"===(null==o?void 0:o.type)?"controlled":"classic";return s.a.createElement(i.Fragment,null,s.a.createElement(p.d,{ref:this.saveButtonRef},s.a.createElement(b,{icon:t,iconOnly:n,isCloseupPin:a,isPulsarDisplayed:!this.state.isRepinModalOpen,onClick:this.handleSaveButtonClick,onSavedClick:this.handleSavedButtonClick,requestContext:u,saveButtonType:f,saved:_,variant:d}),this.renderPinToBoardRepin()),!!c&&this.saveButtonRef.current&&c(this.saveButtonRef.current))}}y(x,"defaultProps",{anchorString:""}),t.default=Object(S.compose)(Object(a.connect)((function({pins:e,viewer:t},{pin:n}){return{email:t.isAuth?t.email:void 0,isAuth:t.isAuth,pinSavedInfo:e[n.id]&&e[n.id].savedInfo,viewerId:t.isAuth?t.id:""}}),(function(e){return{completePinSave:()=>e({type:"COMPLETE_PIN_SAVE"})}})),u.a,Object(d.a)(33),_.a,g.e)((function(e){const t=Object(v.b)();return s.a.createElement(x,Object.assign({},e,{boardPickerStopwatch:t}))}))},w70y:function(e,t,n){n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var i=n("q1tI"),s=n.n(i),a=n("/MKj"),o=n("lSCD"),r=n.n(o),c=n("aK+E"),l=n("zLLH"),u=n("y19s"),h=n("Wer7");const d={};function p({acceptPrefetch:e,allowStale:t,enabledRouteRefresh:n,dangerouslyDisableFetch:s,options:o,name:r,headers:p}){const m=Object(a.useDispatch)(),b=Object(c.a)(o),_=Object(i.useRef)(),f=e=>(e[r]||d)[b]||d,{isPrefetch:v,nextBookmark:g,prefetchHasBeenRead:S}=Object(a.useSelector)(({resources:e})=>f(e.data)),y=Object(a.useSelector)(({resources:e})=>f(e.data).data),C=Object(a.useSelector)(({resources:e})=>f(e.data).error),O=Object(a.useSelector)(({resources:e})=>Boolean((e.fetching[r]||d)[b])),x=Object(a.useSelector)(({resources:e})=>Boolean((e.data[r]||d)[b])),{history:P}=Object(u.b)(),D=P&&"POP"!==P.action,j=Boolean(x&&n&&D&&!s),[E,R]=Object(i.useState)(j);void 0===_.current&&x&&D&&e&&v&&!S&&!s&&m(Object(h.h)(r,o));const A=Object(i.useCallback)(()=>{s||m(Object(h.a)(r,o,p))},[s,m,p,r,b]),T=Object(i.useCallback)(()=>{s||m(Object(h.d)(r,o,p))},[s,p,r,b]),B=Object(i.useCallback)(()=>{s||(A(),R(!0))},[s,A,R]),w=Object(i.useRef)({data:void 0,error:void 0,fetchMore:T,isAtEnd:!1,isFetching:!1,isLoaded:!1,isPrefetch:void 0,isRefreshing:!1,nextBookmark:void 0,prefetchHasBeenRead:void 0,refreshData:B});Object(i.useEffect)(()=>{!1!==t&&x&&!j||A()},[]),Object(i.useEffect)(()=>{void 0!==_.current&&b!==_.current&&D&&A(),_.current=b},[b]);const k={data:y,error:C,fetchMore:T,isAtEnd:x&&!O&&g===l.a,isFetching:O,isLoaded:x,isPrefetch:v,isRefreshing:E,nextBookmark:g,prefetchHasBeenRead:S,refreshData:B};return Object(a.shallowEqual)(k,w.current)||(!E||j||Object(a.shallowEqual)(k.data,w.current.data)||(k.isRefreshing=!1,R(!1)),w.current=k),w.current}function m(e){const t=e.key;return function(n){function i(i){const{dangerouslyDisableFetch:a,options:o,key:c,...l}=e,u=p({...l,options:(r()(o)?o(i):o)||{},dangerouslyDisableFetch:!!a&&a(i)}),h={[t]:u};return s.a.createElement(n,Object.assign({},i,h))}return i.displayName=`withResourceExperimental[${e.name}](${n.displayName||n.name||""})`,i.WrappedComponent=n,i}}},y9Ij:function(e,t,n){n.d(t,"a",(function(){return p}));var i=n("q1tI"),s=n.n(i),a=(n("PNKV"),n("TSYQ")),o=n.n(a),r=n("Ye/N"),c=n("/5zs"),l=n("n6mq");function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const h=32,d=13;class p extends s.a.PureComponent{constructor(...e){super(...e),u(this,"handleKeyPress",e=>{e.charCode!==h&&e.charCode!==d||(e.preventDefault(),this.props.onClick(e))})}render(){const{disabled:e,iconOnly:t,isCloseupPin:n,onClick:i,onSavedClick:a,requestContext:u,saveButtonType:h,saved:d,variant:p}=this.props;if(d&&"controlled"===h)return s.a.createElement(l.e,{disabled:!0,text:r.a._("Saved"),size:"sm"});if(d&&"classic"===h&&n&&u){const e=new c.b(u,"web_save_to_saved");if(e.check("enabled")||e.check("enabled_board"))return s.a.createElement(l.e,{accessibilityLabel:r.a._("Saved button","saveButton.saved.label","Saved state label on save button"),text:r.a._("Saved!","saveButton.saved","Saved state text on save button"),size:"md",color:"white",onClick:e.check("enabled_board")?a:({event:e})=>i(e)})}return t?s.a.createElement("div",{"data-test-id":"SaveButton"},s.a.createElement(l.r,{accessibilityLabel:r.a._("Save","Accessibility label for the save button","Accessibility label for the save button"),bgColor:"white",icon:"pin",onClick:({event:e})=>i(e),iconColor:"darkGray"})):s.a.createElement("div",{className:o()("SaveButton",e?"SaveButton--disabled":"SaveButton--enabled",{"SaveButton--lego":"lego"===p}),"data-test-id":"SaveButton",onClick:e?void 0:i,onKeyPress:e?void 0:this.handleKeyPress,role:"button",tabIndex:"0"},s.a.createElement("div",{className:o()("SaveButton__background",e?"SaveButton__background--disabled":"SaveButton__background--enabled",{"SaveButton__background--lego":"lego"===p})},s.a.createElement(l.d,{alignItems:"center",minHeight:40,dangerouslySetInlineStyle:{__style:{padding:"10px 14px"}},display:"flex"},s.a.createElement(l.R,{color:e?"gray":"white",size:"lego"===p?"sm":"md",weight:"bold"},s.a.createElement("span",{className:o()("SaveButton__label",{"SaveButton__label--lego":"lego"===p})},r.a._("Save","Pin save button label","Pin save button label"))))))}}u(p,"defaultProps",{disabled:!1,icon:!0,saveButtonType:"classic",variant:"classic"})}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/js/PinSaveButtonCommon-8156d14bf2881cf06568.mjs.map